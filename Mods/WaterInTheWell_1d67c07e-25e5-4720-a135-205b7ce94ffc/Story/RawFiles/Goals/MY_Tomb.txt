Version 1
SubGoalCombiner SGC_AND
INITSECTION
DB_Dialogs(ITEMGUID_CEM_Tombstone_H_Dynamic_000_8ce72b2e-0b35-4f7c-8b7c-2958fbddeebb,"TombDialogue");

DB_FlowerCupEmpty((ITEMGUID)ITEMGUID_CON_Flower_Cup_A_Empty_000_d5b4259f-aa65-4a6c-91cb-bbd0a418573e); 
//DB_FlowerCupFull((ITEMGUID)ITEMGUID_CON_Flower_Cup_A_Water_003_7b2dfe57-a645-4822-a324-236dd5f75fc8); 
DB_Kitty(KittyKatie_Ghost_9eadd18f-e2b2-41e0-bb9e-5bc9041316ec);
KBSECTION
IF
DB_IsPlayer(_Player)
THEN
ItemTemplateAddTo("Flower_Cup_A_Water_425c021a-0ddd-44e9-979f-5c90afb060c0", _Player, 1);

IF
CharacterUsedItem(_Player, ITEMGUID_CEM_Tombstone_H_Dynamic_000_8ce72b2e-0b35-4f7c-8b7c-2958fbddeebb)
THEN
Proc_StartDialog(1, "TombDialogue", _Player);//ITEMGUID_BLD_Humans_Tomb_Lid_A_000_9abef75b-fbbd-4647-8da1-b6e074bdbd51

IF
DialogEnded("TombDialogue", _Id)
AND
DB_IsPlayer((CHARACTERGUID)_Player)
AND
DB_FlowerCupEmpty(_EmptyCup)
AND
ItemTemplateIsInUserInventory(_Player, "Flower_Cup_A_Water_425c021a-0ddd-44e9-979f-5c90afb060c0", 0, _FullCupCount)
AND
_FullCupCount > 0
AND
GetItemForItemTemplateInInventory((CHARACTERGUID)_Player, "Flower_Cup_A_Water_425c021a-0ddd-44e9-979f-5c90afb060c0", _FullCup)
//DB_FlowerCupFull(_FullCup)
AND
GetPosition(_EmptyCup, _FlowerCupX, _FlowerCupY, _FlowerCupZ)
THEN
DisplayText(_Player, "Here you go, flowers!");
//ItemTemplateRemoveFrom((STRING)_ItemTemplate, (GUIDSTRING)_Object,(INTEGER)_Count)
ItemMoveToPosition(_FullCup, _FlowerCupX, _FlowerCupY, _FlowerCupZ, 5.0, 5.0, "");
DB_FlowerCupPos(_FlowerCupX, _FlowerCupY, _FlowerCupZ);
ItemToInventory(_EmptyCup, _Player);
NOT DB_FlowerCupEmpty(_EmptyCup);
DB_FlowerCupFull(_FullCup);
ProcObjectTimer(_Player, "KittyDelay", 2000);

PROC
ProcObjectTimerFinished(_Player, "KittyDelay")
AND
DB_IsPlayer((CHARACTERGUID)_Player)
AND
DB_FlowerCupPos(_FlowerCupX, _FlowerCupY, _FlowerCupZ)
AND
CreateItemTemplateAtPosition("ITEMGUID_CON_Flower_Cup_A_Empty_8f68f678-5cf0-43cb-9428-2b8a87806774", _FlowerCupX, _FlowerCupY, _FlowerCupZ,(ITEMGUID)_EmptyCup)
AND
DB_Kitty(_KittyKatie)
AND
CharacterConsume((CHARACTERGUID)_KittyKatie, "ITEMGUID_CON_Flower_Cup_A_Water_425c021a-0ddd-44e9-979f-5c90afb060c0", _)
AND
DB_FlowerCupFull(_FullCup)
THEN
Proc_StartDialog(1, "Narrator", _Player);
//ItemTemplateAddTo("WPN_Tool_Pitchfork_2H_A be051a81-d08d-4fea-9fa4-f1c32049c13d", _Player, 1);
ItemRemove(_FullCup);
//CharacterUseItem((CHARACTERGUID)_KittyKatie, _FullCup, "");

NOT DB_FlowerCupFull(_FullCup);
DB_FlowerCupEmpty(_EmptyCup);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "__Start"
